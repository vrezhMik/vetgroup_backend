import{cA as k,j as e,cB as T,cC as B,b8 as P,e as L,k as p,H as x,cD as I,cF as h,ax as v,r as M,cJ as D,cL as F,eF as H,cG as R,cH as E,x as A,a as S,br as G,G as g,I as b,dJ as N,eG as f,bj as q,aT as z,bD as Q,Q as y,cP as U,cm as w,o as W}from"./strapi-KHJjuXVj.js";import{getDocumentStatus as C}from"./EditViewPage-oOLeTySr--a6XnB3Q.js";import"./Field-D7dv2aUX-hXSzlXaQ.js";import"./Relations-DinMQJ4B-BkUCgZzd.js";import"./useDragAndDrop-DJ6jqvZN-BQfAUmae.js";import"./relations-Boc5Y9kX-CmbOF9Qf.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-CHfHaQ9e.js";import"./objects-D6yBsdmx-Bw_8t8zk.js";import"./useDebounce-DmuSJIF3-4nOlGlF2.js";const $=()=>{const t=u("PreviewContent",s=>s.url),{formatMessage:a}=h();return e.jsx(x,{src:t,title:a({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},t)},J=()=>{const[{query:t}]=v(),{formatMessage:a}=h(),s=f("BackButton",m=>m.canGoBack),n=f("BackButton",m=>m.goBack),i=f("BackButton",m=>m.history),r=f("BackButton",m=>m.currentLocationIndex),l=s?i.at(r-2):void 0,c={pathname:"..",search:q.stringify(t,{encode:!1})},o=l??c,d=m=>{if(s){m.preventDefault(),n();return}};return e.jsx(b,{tag:z,relative:"path",to:o,onClick:d,label:a({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(Q,{})})},O=()=>{const t=u("PreviewHeader",r=>r.document),a=u("PreviewHeader",r=>r.schema),s=u("PreviewHeader",r=>r.meta);if(!(a?.options?.draftAndPublish??!1))return null;const i=C(t,s);return e.jsx(U,{status:i,size:"XS"})},V=()=>{const{formatMessage:t}=h(),[{query:a},s]=v(),n=u("PreviewHeader",d=>d.document),i=u("PreviewHeader",d=>d.schema),r=u("PreviewHeader",d=>d.meta),l=i?.options?.draftAndPublish??!1,c=C(n,r),o=d=>{(d==="published"||d==="draft")&&s({status:d},"push",!0)};return l?e.jsx(e.Fragment,{children:e.jsx(w.Root,{variant:"simple",value:a.status||"draft",onValueChange:o,children:e.jsxs(w.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(j,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(j,{value:"published",disabled:c==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})})}):null},X=()=>{const t=u("PreviewHeader",o=>o.mainField),a=u("PreviewHeader",o=>o.document),s=u("PreviewHeader",o=>o.schema);let n="Untitled";t!=="id"&&a?.[t]?n=a[t]:s.kind==="singleType"&&s?.info.displayName&&(n=s.info.displayName);const{formatMessage:i}=h(),{toggleNotification:r}=S(),{copy:l}=G(),c=()=>{l(window.location.href),r({message:i({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(g.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(g.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(J,{}),e.jsx(Y,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",title:n,children:n}),e.jsx(O,{})]}),e.jsx(g.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx(V,{})}),e.jsx(g.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(b,{type:"button",label:i({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:c,children:e.jsx(N,{})})})]})},Y=y(W)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,j=y(w.Trigger)`
  text-transform: uppercase;
`,[_,u]=k("PreviewPage"),K=()=>{const{formatMessage:t}=h(),{slug:a,id:s,collectionType:n}=P(),[{query:i}]=v(),r=M.useMemo(()=>D(i),[i]);if(!n)throw new Error("Could not find collectionType in url params");if(!a)throw new Error("Could not find model in url params");if(n===F&&!s)throw new Error("Could not find documentId in url params");const l=H({params:{contentType:a},query:{documentId:s,locale:r.locale,status:r.status}}),c=R({model:a,collectionType:n,documentId:s,params:r}),o=E(a);return c.isLoading||l.isLoading||o.isLoading?e.jsx(p.Loading,{}):l.error||o.error||!c.document||!c.meta||!c.schema?e.jsx(p.Error,{}):l.data?.data?.url?e.jsxs(e.Fragment,{children:[e.jsx(p.Title,{children:t({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:o.edit.settings.displayName})}),e.jsx(_,{url:l.data.data.url,mainField:o.edit.settings.mainField,document:c.document,meta:c.meta,schema:c.schema,children:e.jsxs(A,{direction:"column",height:"100%",alignItems:"stretch",children:[e.jsx(X,{}),e.jsx($,{})]})})]}):e.jsx(p.NoData,{})},Z=()=>{const{slug:t}=P(),{permissions:a=[],isLoading:s,error:n}=L([{action:"plugin::content-manager.explorer.read",subject:t}]);return s?e.jsx(p.Loading,{}):n||!t?e.jsx(x,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(p.Error,{})}):e.jsx(x,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(p.Protect,{permissions:a,children:({permissions:i})=>e.jsx(I,{permissions:i,children:e.jsx(K,{})})})})},le=()=>e.jsx(T,{children:e.jsx(B,{children:e.jsx(Z,{})})});export{le as ProtectedPreviewPage,u as usePreviewContext};
