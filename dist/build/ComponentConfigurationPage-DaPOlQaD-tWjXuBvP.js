import{b8 as I,a as v,cF as z,c as O,fi as R,fk as k,r as S,cK as q,fl as G,j as u,k as h,fm as F}from"./strapi-KHJjuXVj.js";import{C as U,T as $}from"./Form-BxR6sc29-TteNEQha.js";import{u as w}from"./hooks-E5u1mcgM-CP-140Q3.js";import{s as K}from"./objects-D6yBsdmx-Bw_8t8zk.js";import"./useDragAndDrop-DJ6jqvZN-BQfAUmae.js";import"./ComponentIcon-u4bIXTFY-CHfHaQ9e.js";import"./FieldTypeIcon-CMlNO8PE-CcldF4-e.js";import"./getEmptyImage-CjqolaH3.js";const Q=q.injectEndpoints({endpoints:e=>({getComponentConfiguration:e.query({query:t=>`/content-manager/components/${t}/configuration`,transformResponse:t=>t.data,providesTags:(t,o,s)=>[{type:"ComponentConfiguration",id:s}]}),updateComponentConfiguration:e.mutation({query:({uid:t,...o})=>({url:`/content-manager/components/${t}/configuration`,method:"PUT",data:o}),transformResponse:t=>t.data,invalidatesTags:(t,o,{uid:s})=>[{type:"ComponentConfiguration",id:s},{type:"ContentTypeSettings",id:"LIST"}]})})}),{useGetComponentConfigurationQuery:B,useUpdateComponentConfigurationMutation:D}=Q,H=()=>{const{slug:e}=I(),{toggleNotification:t}=v(),{formatMessage:o}=z(),{_unstableFormatAPIError:s}=O(),{components:f,fieldSizes:E,schema:r,error:i,isLoading:d,isFetching:T}=R(void 0,{selectFromResult:a=>{const y=a.data?.components.find(n=>n.uid===e),C=a.data?.components.reduce((n,c)=>(n[c.uid]=c,n),{}),p=k(y?.attributes,C),m=Object.entries(a.data?.fieldSizes??{}).reduce((n,[c,{default:j}])=>(n[c]=j,n),{});return{isFetching:a.isFetching,isLoading:a.isLoading,error:a.error,components:p,schema:y,fieldSizes:m}}});S.useEffect(()=>{i&&t({type:"danger",message:s(i)})},[i,s,t]);const{data:g,isLoading:x,isFetching:M,error:l}=B(e??"");S.useEffect(()=>{l&&t({type:"danger",message:s(l)})},[l,s,t]);const _=x||d||M||T,b=S.useMemo(()=>g&&!_?V(g,{schema:r,components:f}):{layout:[],components:{},metadatas:{},options:{},settings:G},[g,_,r,f]),[P]=D(),A=async a=>{try{const y=Object.entries(g?.component.metadatas??{}).reduce((p,[m,{edit:n,list:c}])=>{const{__temp_key__:j,size:J,name:W,...N}=a.layout.flatMap(L=>L.children).find(L=>L.name===m)??{};return p[m]={edit:{...n,...N},list:c},p},{}),C=await P({layouts:{edit:a.layout.map(p=>p.children.reduce((m,{name:n,size:c})=>n!==$?[...m,{name:n,size:c}]:m,[])),list:g?.component.layouts.list},settings:K(a.settings,"displayName",void 0),metadatas:y,uid:e});"data"in C?t({type:"success",message:o({id:"notification.success.saved",defaultMessage:"Saved"})}):t({type:"danger",message:s(C.error)})}catch{t({type:"danger",message:o({id:"notification.error",defaultMessage:"An error occurred"})})}};return _?u.jsx(h.Loading,{}):l||i||!r?u.jsx(h.Error,{}):u.jsxs(u.Fragment,{children:[u.jsx(h.Title,{children:`Configure ${b.settings.displayName} Edit View`}),u.jsx(U,{onSubmit:A,attributes:r.attributes,fieldSizes:E,layout:b})]})},V=(e,{schema:t,components:o})=>{const s=F(e.component.layouts.edit,t?.attributes,e.component.metadatas,{configurations:e.components,schemas:o}),f=Object.entries(e.components).reduce((r,[i,d])=>(r[i]={layout:F(d.layouts.edit,o[i].attributes,d.metadatas),settings:{...d.settings,icon:o[i].info.icon,displayName:o[i].info.displayName}},r),{}),E=Object.entries(e.component.metadatas).reduce((r,[i,d])=>({...r,[i]:d.edit}),{});return{layout:[s],components:f,metadatas:E,options:{...t?.options,...t?.pluginOptions},settings:{...e.component.settings,displayName:t?.info.displayName}}},it=()=>{const e=w(t=>t.admin_app.permissions.contentManager?.componentsConfigurations);return u.jsx(h.Protect,{permissions:e,children:u.jsx(H,{})})};export{H as ComponentConfigurationPage,it as ProtectedComponentConfigurationPage};
