import{av as k,aN as G,u as C,h as W,cV as D,r as M,cZ as Y,cQ as q,j as e,P as u,ba as H,$ as Z,eQ as _,cw as p,eR as S,Q as m,eS as J,eT as K,eU as T,bn as X,m as ee,cN as te,eV as se,d as ae,F as E,B as ne,cO as ie}from"./strapi-BVlQgZ46.js";import{a as oe,f as re,t as ce,g as I}from"./Field-D7dv2aUX-CXuEgMn0.js";import"./Relations-DinMQJ4B-Ew92R2sP.js";import"./useDragAndDrop-DJ6jqvZN-D6P7bvxO.js";import"./relations-Boc5Y9kX-B3W_FNFh.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-Dgj1W7GC.js";import"./objects-D6yBsdmx-BxxPmA9j.js";import"./useDebounce-DmuSJIF3-CZyT9Er0.js";const de=a=>M.useEffect(a,le),le=[],v=({layout:a})=>{const{formatMessage:o}=C(),{model:c}=D();return e.jsx(E,{direction:"column",alignItems:"stretch",gap:6,children:a.map((r,d)=>{if(r.some(t=>t.some(i=>i.type==="dynamiczone"))){const[t]=r,[i]=t,g={...i,label:o({id:`content-manager.content-types.${c}.${i.name}`,defaultMessage:i.label})};return e.jsx(m.Root,{gap:4,children:e.jsx(m.Item,{col:12,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(I,{...g})})},i.name)}return e.jsx(ne,{hasRadius:!0,background:"neutral0",shadow:"tableShadow",paddingLeft:6,paddingRight:6,paddingTop:6,paddingBottom:6,borderColor:"neutral150",children:e.jsx(E,{direction:"column",alignItems:"stretch",gap:6,children:r.map((t,i)=>e.jsx(m.Root,{gap:4,children:t.map(({size:g,...s})=>{const l={...s,label:o({id:`content-manager.content-types.${c}.${s.name}`,defaultMessage:s.label})};return e.jsx(m.Item,{col:g,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(I,{...l})},s.name)})},i))})},d)})})},ue=()=>{const a=k(),[{query:{status:o}},c]=G({status:"draft"}),{formatMessage:r}=C(),{toggleNotification:d}=W(),{document:t,meta:i,isLoading:g,schema:s,components:l,collectionType:A,id:B,model:F,hasError:N}=D(),j=s?.options?.draftAndPublish??!1;de(()=>{a?.state&&"error"in a.state&&d({type:"danger",message:a.state.error,timeout:5e3})});const V=Y("EditViewPage",n=>n.isLoading),h=A===se,f=!B&&!h,{isLoading:w,edit:{layout:P,settings:{mainField:b}}}=q(F),{isLazyLoading:Q}=oe([]),$=V||g||w||Q,y=M.useMemo(()=>{if(!t&&!f&&!h||!s)return;const n=t?.id?t:re(s,l);return ce(s,l)(n)},[t,f,h,s,l]);if(N)return e.jsx(u.Error,{});if($&&!t?.documentId)return e.jsx(u.Loading,{});if(!y)return e.jsx(u.Error,{});const z=n=>{(n==="published"||n==="draft")&&c({status:n},"push",!0)};let x="Untitled";b!=="id"&&t?.[b]?x=t[b]:h&&s?.info.displayName&&(x=s.info.displayName);const O=(n,L)=>T(s?.attributes,l,{status:o,...L}).validateSync(n,{abortEarly:!1});return e.jsxs(H,{paddingLeft:10,paddingRight:10,children:[e.jsx(u.Title,{children:x}),e.jsx(Z,{disabled:j&&o==="published",initialValues:y,method:f?"POST":"PUT",validate:(n,L)=>T(s?.attributes,l,{status:o,...L}).validate(n,{abortEarly:!1}),initialErrors:a?.state?.forceValidation?O(y,{}):{},children:({resetForm:n})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{isCreating:f,status:j?me(t,i):void 0,title:x}),e.jsxs(p.Root,{variant:"simple",value:o,onValueChange:z,children:[e.jsx(p.List,{"aria-label":r({id:S("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:j?e.jsxs(e.Fragment,{children:[e.jsx(R,{value:"draft",children:r({id:S("containers.edit.tabs.draft"),defaultMessage:"draft"})}),e.jsx(R,{disabled:!i||i.availableStatus.length===0,value:"published",children:r({id:S("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),e.jsxs(m.Root,{paddingTop:8,gap:4,children:[e.jsxs(m.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[e.jsx(p.Content,{value:"draft",children:e.jsx(v,{layout:P})}),e.jsx(p.Content,{value:"published",children:e.jsx(v,{layout:P})})]}),e.jsx(m.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:e.jsx(J,{})})]})]}),e.jsx(K,{onProceed:n})]})})]})},R=ae(p.Trigger)`
  text-transform: uppercase;
`,me=(a,o)=>{const c=a?.status,r=o?.availableStatus??[];return c?c==="draft"&&r.find(d=>d.publishedAt!==null)?"published":c:"draft"},Se=()=>{const{slug:a=""}=X(),{permissions:o=[],isLoading:c,error:r}=ee(ie.map(d=>({action:d,subject:a})));return c?e.jsx(u.Loading,{}):r||!a?e.jsx(u.Error,{}):e.jsx(u.Protect,{permissions:o,children:({permissions:d})=>e.jsx(te,{permissions:d,children:e.jsx(ue,{})})})};export{ue as EditViewPage,Se as ProtectedEditViewPage,me as getDocumentStatus};
